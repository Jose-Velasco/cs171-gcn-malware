FROM tensorflow/tensorflow:latest-gpu as base

# # Install dependencies
FROM base as py-deps

# GPU install
RUN pip3 install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118

COPY requirements.txt requirements.txt

RUN pip install -r requirements.txt

FROM py-deps as runtime

# Create and switch to a new user
RUN useradd --create-home appdev
WORKDIR /home/appdev/src
USER appdev

COPY . .

# EXPOSE 8888

# ENTRYPOINT ["jupyter", "lab","--ip=0.0.0.0","--allow-root","--no-browser"]